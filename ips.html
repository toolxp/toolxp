
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IP 泄露检测</title>
<style>
body {
    background: #0e111b;
    margin: 0;
    min-height: 100vh;
    background-image: linear-gradient(90deg, #3f3f3f13 1px, transparent 1px), /* 垂直线条 */ linear-gradient(180deg, #3f3f3f13 1px, transparent 1px), /* 水平线条 */ linear-gradient(135deg, #000000, #0b0d10, #151927, #090d18, #000000);
    background-size: 60px 60px, 60px 60px, cover;
    background-repeat: repeat, repeat, no-repeat;
    background-attachment: fixed;
    background-blend-mode: screen, screen, normal;
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #0e111b10;
    padding: 0.5rem 1.5rem;
    border-bottom: 1px solid #273367;
    flex-wrap: wrap;
}

  .sitename {
    font-size: 1.2rem;
    font-weight: bold;
    color: #ff8033;
  }

  .nav-toggle {
    display: none;
    font-size: 1.5rem;
    background: none;
    border: none;
    cursor: pointer;
  }

  .nav-links {
    display: flex;
    gap: 1rem;
    font-size: 17px;
    flex-wrap: nowrap; /* 防止导航文本换行 */
    white-space: nowrap; /* 确保文本不换行 */
  }

  .nav-links a {
    text-decoration: none;
    padding: 0.5rem;
    color: #6fcdfb;
  }

  /* 子菜单的新样式 */
  .submenu {
    flex-direction: column;
    position: absolute;
    width: 100%;
    border-radius: 4px;
    margin-top: 15px;
    background-color: transparent;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-20px);
    transition:
      opacity 0.3s ease,
      transform 0.3s ease,
      visibility 0.3s ease;
    min-width: 0; /* 取消最小宽度限制 */
    padding: 0; /* 去除多余的内边距 */
    width: auto; /* 让子菜单宽度自适应 */
  }

  .submenu a {
    display: block;
    padding: 0.8rem;
    color: #6fcdfb;
    text-align: left;
    background: transparent;
  }

  .nav-links a:hover,
  .submenu a:hover {
        color: #fffb05;
/*        transform: scale(1.2); */
        text-shadow: 0 0 26px rgba(255, 251, 5, 1),
            0 0 31px rgba(255, 251, 5, 1),
            0 0 36px rgba(255, 251, 5, 0.7);
  }

  /* 响应式样式 */
  @media (max-width: 700px) {
    .nav-toggle {
      display: block;
      color: #05fff6;
      font-size: 25px;
    }

    .nav-links {
      flex-direction: column;
      width: 100%;
      display: none;
      gap: 0;
    }

    .nav-links.active {
      display: flex;
    }

    .nav-links a,
    .menu-item {
      width: auto;
      text-align: center;
      padding: 1rem;
      border-top: 1px solid rgba(39, 51, 103);
    }

    .navbar {
      flex-direction: column;
      align-items: flex-start;
    }

    .navbar-header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: auto 6% auto 3%;
      height: 50px;
    }

    /* 移动子菜单调整 */
    .submenu {
      position: static;
      opacity: 0;
      transform: translateY(-20px);
      transition:
        opacity 0.3s ease,
        transform 0.3s ease;
      visibility: hidden;
      display: none; /* 确保不占用空间 */
    }

    .submenu.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      display: flex; /* 活动时显示子菜单 */
    }

    .menu-item {
      width: auto;
      text-align: center;
      padding: 1rem;
    }

    .menu-item a:focus {
      outline: none;
    }

    .nav-links a:hover {
      background-color: transparent;
      border-radius: 4px;
    }
  }

  /* 桌面悬停子菜单 */
  @media (min-width: 701px) {
    .nav-links .menu-item {
      position: relative;
    }

    .submenu {
      visibility: hidden; /* 默认隐藏子菜单 */
      opacity: 0;
      transform: translateY(-10px);
      transition:
        opacity 0.3s ease,
        transform 0.3s ease,
        visibility 0.3s ease;
    }

    .menu-item:hover .submenu {
      visibility: visible; /* 悬停时显示子菜单 */
      opacity: 1;
      transform: translateY(0);
    }

    /* 防止子菜单消失得太快 */
    .menu-item:hover .submenu {
      pointer-events: auto;
    }
  }

  .main-content {
    padding: 10px 20px;
    margin-top: 30px;
    height: auto;
  }

  .containerpost {
    max-width: 1250px;
    margin: 0 auto;
    border-radius: 8px;
    line-height: 1.6;
    color: #d1d1d1;
    --border-color: #95e6ff;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .menu-item {
    margin-top: auto;
    margin-bottom: auto;
    position: relative;
  }
</style>





<style>
.zhanshikuang {
    margin: 30px auto;
}
h1, p {
    color: #6fcdfb;
}
</style>





</head>

<body>
    <nav class="navbar">
        <div class="navbar-header">
            <div class="sitename">ToolXp</div>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
        </div>
        <div class="nav-links" id="navMenu">
            <a href="#">Home</a>


            <div class="menu-item">
                <a href="javascript:void(0);" onclick="toggleSubMenu()">工具分类</a>
                <div class="submenu">
                    <a href="#">工具1</a>
                    <a href="#">工具2</a>
                    <a href="#">工具3</a>
                </div>
              </div>
<!--
<div class="menu-item">
  <a href="javascript:void(0);" onclick="toggleIpSubMenu()">IP 工具</a>
  <div class="submenu" id="ipSubmenu">
            <a href="#">IP/DNS泄露检测</a>
            <a href="#">游览器安全检测</a>
            <a href="#">IP黑名单检测</a>
            <a href="#">临时EDU邮箱</a>
            <a href="#">IP综合质量查询</a>
            <a href="#">HTML混淆器</a>
            <a href="#">代码格式化</a>
  </div>
</div>
-->
            <a href="#">隐私</a>
            <a href="#">关于</a>



           </div>
        </div>
    </nav>
    <div class="main-content">

    <div class="containerpost">
        

<!-- h1标题 -->
<div class="zhanshikuang"><h1>IP 泄露检测</h1></div>
    
<!-- 页面内容 -->



<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "检测结果显示“IP 未泄露”代表什么？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "说明你的浏览器仅暴露了一个 IP，可能的原因包括：你未使用代理或 VPN；你使用了代理/VPN，且其配置安全、未发生泄露。"
      }
    },
    {
      "@type": "Question",
      "name": "检测结果显示“检测到多个不同的 IP”代表什么？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "说明你的浏览器暴露了多个来自不同自治系统（AS）的 IP。这通常意味着你正在使用代理或 VPN，并且存在 IP 泄露的可能，真实 IP 可能已被检测到。"
      }
    },
    {
      "@type": "Question",
      "name": "为什么页面上显示“未检测到”？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "可能原因包括：网络波动或连接不稳定；你做了有效的隐藏措施；使用单栈或双栈网络；WebRTC 已关闭或隐藏了 IP；检测通道不稳定。"
      }
    },
    {
      "@type": "Question",
      "name": "如何判断我的 IP/DNS 是否泄露？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "此工具会使用多个出口检测公网 IP 地址。如果你在开启代理/VPN 的情况下，真实 IP 和本地 DNS 仍然被检测到，可以确认已经泄露。"
      }
    },
    {
      "@type": "Question",
      "name": "如何查询我的 IP 纯净度、综合质量？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "你可以使用 IP质量检测工具进行全面检测。"
      }
    },
    {
      "@type": "Question",
      "name": "IPv4 和 IPv6 有什么区别？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "IPv4 使用 32 位地址，资源紧张；IPv6 使用 128 位地址，资源丰富且更安全，支持更快连接并减少 NAT 需求。"
      }
    },
    {
      "@type": "Question",
      "name": "为什么我的 IP 地址会变化？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "如果你的 ISP 提供的是动态 IP，每次重新连接网络时可能会变化。更换 VPN、代理、Wi-Fi 或移动数据也会导致 IP 变化。"
      }
    },
    {
      "@type": "Question",
      "name": "如何隐藏我的 IP 地址，防止 IP 地址被追踪？",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "你可以使用 VPN、关闭分流代理、启用 TUN 模式、定期更换网络、禁用 WebRTC、使用匿名浏览器或 Tor 网络，并避免在社交媒体暴露 IP 信息。"
      }
    }
  ]
}

</script>


<style>
/* 这里不要修改 */
/*
.sidebar {
    display: none;
}

.main-content {
    max-width: 1375px;
    margin-left: auto;
    margin-right: auto;
    display: block !important;
}

.content__entry {
    max-width: 100%;
}

.l-grid--2col {
    grid-template-columns: repeat(3, 1fr);
}

@media (min-width: 75em) {
    .home-template .l-grid {
        grid-column-gap: 3.5rem;
    }
}
*/
/* 上面的内容不要修改 */



@media (min-width:768px) {
    .col-md-8 {
        flex: 0 0 80.66667%;
        max-width: 80.66667%
    }
}

.ip-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    max-width: 868px;
    padding: 20px 10px;
    border-radius: 8px;
    font-size: 18px;
    border: 1px solid #31353b;
    background: #00000060;
}

.ip-left {
    display: flex;
    align-items: center;
    gap: 12px;
    text-align: left;
    color: #00ceff;
}

.ip-label {
    padding: 4px 8px;
    border-radius: 4px;
}

.ip-right {
    margin-left: auto;
    text-align: right;
    font-size: 17px;
    color: #eee;
}

@media (max-width:768px) {
    .ip-item {
        flex-direction: column;
        align-items: flex-start;
        padding: 12px;
    }

    .ip-left,
    .ip-right {
        width: 100%;
        text-align: left;
        margin: 6px 0;
    }

    .ip-label {
        font-size: 18px;
    }
}

#dns-container,
#ip-container {
    display: none;
    width: 95px;
}

#query-ip-button:hover {
    background: #2e93ff !important;
    color: #fff !important;
}

.content__entry.u-inner {
    border: 1px solid #31353b;
    border-radius: 8px;
    padding: 30px;
    background: #161b21;
}
</style>
<style>
  .custom-display-box {
    border: 2px solid rgba(255, 99, 71, 0.5);
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(255, 99, 71, 0.4);
    margin-bottom: 20px;
    position: relative;
    transition: transform 0.3s ease;
    margin-top: 60px;
  }

 /* .custom-display-box:hover { 
    transform: scale(1.05);
  }
*/
  .custom-icon {
    position: absolute;
    top: -15px;
    left: -20px;
    background: rgba(255, 99, 71, 0.8);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 10px rgba(255, 99, 71, 0.6);
  }

  .custom-content {
    color: #ccc;
    font-size: 1rem;
    font-family: 'Arial', sans-serif;
  }

  .custom-display-box:before, .custom-display-box:after {
    content: '';
    position: absolute;
    width: 10px;
    height: 100%;
    background: linear-gradient(180deg, transparent, rgba(255, 99, 71, 0.7), transparent);
    top: 0;
    right: 0;
    border-radius: 10px;
  }

  .custom-display-box:before {
    transform: rotate(45deg);
  }

  .custom-display-box:after {
    transform: rotate(-45deg);
  }

.query-ip-button {
    display: block; 
    margin: 160px auto 70px auto; 
    background: #8d28a5; 
    color: #fff; 
    border: none;
    width: 200px;
    height: 50px;
}
</style>

<section><div class="tip-box">本工具可一键检测 <strong>你的 IP/DNS 泄露情况。</strong></div></section>

<section>
<div class="custom-display-box">
  <div class="custom-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#ffffff" d="m15.8 18.5l6 1.6l-.4 1.9l-9.4-2.5L2.6 22l-.5-1.9l6-1.6L2 16.9l.5-1.9l9.4 2.5l9.4-2.5l.5 1.9zM18 8c0 1.8-.8 3.3-2 4.4V15h-2v-2h-1v2h-2v-2h-1v2H8v-2.6C6.8 11.3 6 9.8 6 8a6 6 0 0 1 6-6a6 6 0 0 1 6 6m-7-.5c0-.8-.7-1.5-1.5-1.5S8 6.7 8 7.5S8.7 9 9.5 9S11 8.3 11 7.5m2 3.5l-1-2l-1 2zm3-3.5c0-.8-.7-1.5-1.5-1.5S13 6.7 13 7.5S13.7 9 14.5 9S16 8.3 16 7.5"/></svg>
  </div>
  <div class="custom-content">
    如果你已开启了 代理/VPN , 检测结果中依然显示了你的 真实 IP/DNS <br>请注意 隐私泄露风险！
  </div>
</div>
</section>

<button id="query-ip-button" aria-label="进行检测">
    一键检测
</button>



<div id="ip-container"></div> <!-- IP 自动填充 -->
<div id="dns-container"></div> <!-- DNS 自动填充 -->

<section class="faq-section">
  <h2>常见问题解答</h2>
  <div class="faq">
<details>
  <summary>检测结果显示“IP 未泄露”代表什么？</summary>
  <p>说明你的浏览器仅暴露了一个 IP，可能的原因包括：</p>
  <ul>               
    <li>你未使用代理或 VPN；</li>
    <li>你使用了代理/VPN，且其配置安全、未发生泄露。</li>
  </ul>
</details>

<details>
  <summary>检测结果显示“检测到多个不同的 IP”代表什么？</summary>
  <p>说明你的浏览器暴露了多个来自不同自治系统（AS）的 IP。这通常意味着你正在使用代理或 VPN，并且存在 IP 泄露的可能，真实 IP 可能已被检测到。</p>
</details>

    <details>
      <summary>为什么页面上显示“未检测到”？</summary>
      <p>有以下几种可能：</p>
            <ul>               
                <li>你目前的网络波动较大，连接不稳定；</li>
                <li>你做了一些有效的隐藏措施；</li>
                <li>你是单栈网络；</li>
                <li>你是双栈网络，默认 IPv4/v6 优先；</li>
                <li>你的 WebRTC 已关闭或隐藏了 IP；</li>
                <li>检测通道不稳定。</li>
            </ul>

    </details>
    <details>
      <summary>如何判断我的 IP/DNS 是否泄露？</summary>
      <p>此工具会使用多个出口检测公网 IP 地址。如果你在已经开启了 代理/VPN 的情况下, 真实 IP 和本地的 DNS 仍然被检测到，可以确认已经泄露 。</p>
    </details>
    <details>
      <summary>如何查询我的 IP 纯净度、综合质量？</summary>
      <p>你可以使用 <a href="/ip-quality" target="_blank" class="green-link" aria-label="跳转至 IP质量检测工具页面">IP质量检测工具</a> 进行全面检测。</p>
    </details>
    <details>
      <summary>IPv4 和 IPv6 有什么区别？</summary>
      <p>IPv4 使用 32 位地址，全球 IP 资源紧张；IPv6 采用 128 位地址，提供更丰富的 IP 资源，同时增强了安全性。IPv6 还支持更快的网络连接，并减少 NAT（网络地址转换）的需求，使设备能更直接地访问互联网。</p>
    </details>
    <details>
      <summary>为什么我的 IP 地址会变化？</summary>
      <p>如果你的 ISP 提供的是 **动态 IP**，那么你的 IP 地址可能会在每次重新连接网络时发生变化，更换 VPN 和 代理，Wi-Fi ，移动数据，也会发生变化。</p>
    </details>
    <details>
      <summary>如何隐藏我的 IP 地址，防止 IP 地址被追踪？</summary>
      <p>要防止 IP 地址被追踪，你可以：</p>
            <ul>
                <li>使用可靠的 VPN 或代理服务器隐藏真实 IP；</li>
                <li>关闭分流代理并开启 TUN 模式；</li>
                <li>定期更换网络或动态 IP 地址；</li>
                <li>禁用 WebRTC 以防止真实 IP 泄露；</li>
                <li>使用匿名浏览器或 Tor 网络增强隐私保护；</li>
                <li>避免在社交媒体暴露 IP 相关信息。</li>
            </ul>
           <p> 这些措施可以有效减少第三方对你真实 IP 地址的跟踪，提高在线隐私安全性。</p>
    </details>
  </div>
</section>

<!--
<script src="https://1.907000.xyz/ip.xielou.js"></script>
-->

<script>
(function(){
  const payload = () => {




    // 确保 fetchGeoInfo 在全局作用域中可以被访问
    async function fetchGeoInfo(ip, geoElementId) {
        const location = await getIPLocation(ip);
        document.getElementById(geoElementId).textContent = location || "未检测到归属地";
    }

    async function getIPLocation(ip) {
        try {
            const response = await fetch(`https://api.ipinfo.io/lite/${ip}?token=02e0f20cbd1c07`);
            const data = await response.json();
            if (data.ip) {
                // 提取并返回相应的地理位置信息
                return `${data.country_code} - ${data.as_name} - ${data.asn}`;
            }
            return "未检测到归属地";
        } catch (error) {
            return "获取归属地失败";
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const ipSources = [
            { id: "cn1", label: "①", url: "https://myip.ipip.net/json", parse: (data) => data.data?.ip || "未知", type: "json" },
            { id: "cn2", label: "②", url: "https://app.netart.cn/network-panel/ip.ajax", parse: (data) => data.data?.ip || "未知", type: "json" },
            { id: "us1", label: "③", url: "https://v4.api.ipinfo.io/lite/me?token=02e0f20cbd1c07", parse: (data) => data.ip || "未知", type: "json" },
            { id: "us2", label: "④", url: "https://v6.api.ipinfo.io/lite/me?token=02e0f20cbd1c07", parse: (data) => data.ip || "未知", type: "json" },
            { id: "user-ipv4", label: "⑤", url: "https://api.ipify.org?format=json", parse: (data) => data.ip || "未知", type: "json" },
            { id: "webrtc-ip", label: "⑥", parse: () => "检测中...", type: "webrtc" },
            { id: "user-ipv6", label: "⑦", url: "https://api6.ipify.org?format=json", parse: (data) => data.ip || "未知", type: "json" },
            { id: "user-ipv6-test", label: "⑧", url: "https://ipv6.ddnspod.com", parse: (data) => data, type: "text" },
            { id: "user-ipv6-new", label: "⑨", url: "https://ipv6.losangeles.test-ipv6.com/ip/?callback=jsonpIPv6Callback", type: "jsonp" } // JSONP 用于第⑨个 IP 检测
        ];

        const dnsAPIs = [
            { name: "DNS1", url: "https://edns.ip-api.com/json", id: "dns-ip-api" },
            { name: "DNS2", url: `https://${generateRandomDomain()}.ipv4.surfsharkdns.com`, id: "dns-surfshark" }
        ];

        const ipContainer = document.getElementById("ip-container");
        const dnsContainer = document.getElementById("dns-container");
        ipContainer.style.display = "none"; 
        dnsContainer.style.display = "none"; // 默认隐藏 DNS 区域

        ipSources.forEach(({ id, label }) => {
            ipContainer.innerHTML += `
                <div class="ip-item">
                    <div class="ip-left">
                        <span class="ip-label">${label}</span>
                        <span id="${id}">等待检测...</span>
                    </div>
                    <div class="ip-right">
                        <span id="${id}-geo">等待检测归属地...</span>
                    </div>
                </div>
            `;
        });

        dnsAPIs.forEach(api => {
            dnsContainer.innerHTML += `
                <div class="ip-item">
                    <div class="ip-left" id="${api.id}-name">${api.name}</div>
                    <div class="ip-right" id="${api.id}">DNS检测中...</div>
                </div>
            `;
        });

        let ipDetectionCompleted = false;

        document.getElementById("query-ip-button").addEventListener("click", function () {
            startDetection();
        });

        async function fetchIP(url, id, parseFunction, responseType, delay) {
            setTimeout(async () => {
                try {
                    const response = await fetch(url);
                    const data = responseType === "text" ? await response.text() : await response.json();
                    const ipAddress = parseFunction(data);
                    document.getElementById(id).textContent = ipAddress;

                    if (ipAddress !== "未知") {
                        fetchGeoInfo(ipAddress, `${id}-geo`);
                    } else {
                        document.getElementById(`${id}-geo`).textContent = "未检测到";
                    }
                } catch {
                    document.getElementById(id).textContent = "未检测到";
                    document.getElementById(`${id}-geo`).textContent = "未检测到";
                }
            }, delay);
        }

        async function checkWebRTC() {
            const webrtcStatusElement = document.getElementById("webrtc-ip");
            const webrtcGeoElement = document.getElementById("webrtc-ip-geo");

            if (!window.RTCPeerConnection) {
                webrtcStatusElement.textContent = "未检测到";
                webrtcGeoElement.textContent = "未检测到";
                return;
            }

            const rtcPeerConnection = new RTCPeerConnection({
                iceServers: [
                    { urls: "stun:stun.ss.aaak.dpdns.org:3478" },
                    { urls: "stun:stun3.l.google.com:19302" },
                    { urls: "stun:stun1.l.google.com:19302" },
                    { urls: "stun:stun2.l.google.com:19302" },
                    { urls: "stun:stun.voipbuster.com" },
                    { urls: "stun:stun4.l.google.com:19302" }
                ]
            });

            rtcPeerConnection.createDataChannel("");

            let detectedIP = null;

            rtcPeerConnection.onicecandidate = async (event) => {
                if (event.candidate && !detectedIP) {
                    const ipMatch = event.candidate.candidate.match(/(\d+\.\d+\.\d+\.\d+)/);
                    if (ipMatch) {
                        detectedIP = ipMatch[1];
                        webrtcStatusElement.textContent = detectedIP;
                        webrtcGeoElement.textContent = await getIPLocation(detectedIP);
                    }
                }
            };

            rtcPeerConnection.onicegatheringstatechange = () => {
                if (rtcPeerConnection.iceGatheringState === "complete" && !detectedIP) {
                    webrtcStatusElement.textContent = "未检测到";
                    webrtcGeoElement.textContent = "未检测到";
                }
            };

            await rtcPeerConnection.createOffer().then(offer => rtcPeerConnection.setLocalDescription(offer));

            setTimeout(() => {
                if (!detectedIP && webrtcStatusElement.textContent === "检测中...") {
                    webrtcStatusElement.textContent = "未检测到";
                    webrtcGeoElement.textContent = "未检测到";
                }
            }, 3000);
        }

        async function startDetection() {
            ipContainer.style.display = "block";
            dnsContainer.style.display = "block"; // 显示 DNS 检测区域

            let delay = 1000;
            ipSources.forEach(({ url, id, parse, type }) => {
                if (type === "webrtc") {
                    checkWebRTC();  // 仅启动 WebRTC 检测
                } else if (type !== "jsonp") {
                    fetchIP(url, id, parse, type, delay);  // 处理其他 IP 请求
                }
                delay += 700;
            });

            // 必须要设置第⑨个 IP 检测（JSONP）
            setTimeout(() => {
                const script = document.createElement("script");
                script.src = "https://ipv6.losangeles.test-ipv6.com/ip/?callback=jsonpIPv6Callback";  // JSONP 请求
                script.onerror = function () {
                    document.getElementById("user-ipv6-new").textContent = "未检测到";
                    document.getElementById("user-ipv6-new-geo").textContent = "未检测到";
                };
                document.body.appendChild(script);
            }, 700 + ipSources.length * 700);

            setTimeout(() => {
                ipDetectionCompleted = true;
                if (ipDetectionCompleted) {
                    checkDNSLeak();
                    showLeakHint(); // 添加提示逻辑
                }
            }, 700 + ipSources.length * 700);
        }

// 提示逻辑函数
function showLeakHint() {
  const geoElements = document.querySelectorAll('[id$="-geo"]');
  const asNames = new Set();

  geoElements.forEach(el => {
    const text = el.textContent;
    if (text && text.includes(' - ')) {
      const parts = text.split(' - ');
      const asName = parts[1]?.trim();
      if (asName && asName !== '未检测到归属地' && asName !== '获取归属地失败') {
        asNames.add(asName);
      }
    }
  });

  const hint = document.createElement('div');
  hint.style.cssText = `
    margin: 20px auto;
    text-align: center;
    font-weight: bold;
    color: #ffffff;
    padding: 10px;
    max-width: 400px;
  `;

  if (asNames.size <= 1) {
    hint.textContent = '🟢 IP 未泄露 🟢';
  } else {
    hint.textContent = '🟡 检测到多个不同的 IP 🟡';
  }

  const button = document.getElementById('query-ip-button');
  button.insertAdjacentElement('afterend', hint);
}

        async function checkDNSLeak() {
            let results = await Promise.all(dnsAPIs.map(api => fetchDNSResult(api)));
        }

        async function fetchDNSResult(api, attempt = 1) {
            try {
                let response = await fetch(api.url, { cache: "no-store" });
                if (!response.ok) {
                    throw new Error(`HTTP 状态码: ${response.status}`);
                }
                let data = await response.json();
                let dnsInfoLeft = "解析失败";
                let dnsInfoRight = "";
                if (api.name === "DNS1" && data.dns) {
                    dnsInfoLeft = `DNS - ${data.dns.ip}`;
                    dnsInfoRight = data.dns.geo;
                } else if (api.name === "DNS2" && Object.keys(data).length > 0) {
                    let ipKey = Object.keys(data)[0];
                    dnsInfoLeft = `DNS - ${data[ipKey].IP}`;
                    dnsInfoRight = `${data[ipKey].CountryCode} - ${data[ipKey].City} - ${data[ipKey].ISP}`;
                }
                document.getElementById(`${api.id}-name`).textContent = dnsInfoLeft;
                document.getElementById(api.id).textContent = dnsInfoRight;
            } catch (error) {
                if (attempt === 1) {
                    return fetchDNSResult(api, 2);
                } else {
                    document.getElementById(api.id).textContent = `请求失败: ${error.message}`;
                }
            }
        }

        function generateRandomDomain() {
            return `test-${Math.random().toString(36).substring(2, 12)}`;
        }
    });

    // 确保回调函数是全局的
    window.jsonpIPv6Callback = function (data) {
        const ipv6 = data.ip || "未检测到";
        document.getElementById("user-ipv6-new").textContent = ipv6;

        // 查询归属地
        fetchGeoInfo(ipv6, "user-ipv6-new-geo");
    };

    // 自毁自身 script 标签
    document.currentScript?.remove();
  };

  payload();
})();
</script>


















<!-- 页面内容结束 -->
    </div><!-- containerpost 结束 -->
  </div><!-- main-content 结束 -->


    <script>
        function toggleNav() {
            document.getElementById('navMenu').classList.toggle('active');
        }

        function toggleSubMenu() {
            // Toggle the submenu visibility when clicking "工具分类"
            const submenu = document.querySelector('.menu-item .submenu');
            submenu.classList.toggle('active');
        }

function toggleIpSubMenu() {
  const submenu = document.getElementById('ipSubmenu');
  submenu.classList.toggle('active');
}

    </script>

</body>

</html>
